#!/usr/bin/env bash

kubeernetes_sql_forward() {
  if [[ ${#} -lt 2 ]]; then
    var_red "Usage: sql_forward ENV NAME PORT=5432"
    return 1
  fi

  local CMD="k${1-}"
  shift

  local NAME="${1-}"
  shift

  local PORT="${1-5432}"
  shift || true

  local POSTGRES_PORT="${3:-5432}"
  sql_find_port

  _print_and_run() {
    printf -- "%b%s%b\n" "${YELLOW}" "${*}" "${RESET}" 1>&2
    "${@}"
  }

  _print_and_run kubectl port-forward $(${CMD} find pod "${NAME}") --address "127.0.0.1" "${PORT}:${POSTGRES_PORT}"
}
